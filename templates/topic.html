{% extends "base.html" %}

{% block title %}{{ topic.title }} - Dash Forum{% endblock %}

{% block content %}
<div class="topic-detail">
    <div class="topic-detail-header">
        <h1>{{ topic.title }}</h1>
        <div class="topic-detail-meta">
            <div class="author-info">
                <span class="author">Автор: {{ topic.author.username }}</span>
                <span class="date">Создано: {{ topic.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
            </div>
            <div class="topic-stats">
                <span class="views">Просмотров: {{ topic.views }}</span>
                <span class="replies">Ответов: {{ topic.reply_count }}</span>
            </div>
        </div>
    </div>
    
    <div class="topic-detail-content">
        {{ topic.content|replace('\n', '<br>')|safe }}
    </div>
    
    <div class="topic-actions">
        {% if current_user.is_authenticated %}
            <a href="#reply-form" class="btn">Ответить</a>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn">Войдите, чтобы ответить</a>
        {% endif %}
    </div>
</div>

<div class="reply-list">
    <h2 class="section-title">Ответы ({{ topic.reply_count }})</h2>
    
    {% if topic.replies %}
        {% for reply in topic.replies %}
        <div class="reply-item">
            <div class="reply-header">
                <div class="reply-author">{{ reply.author.username }}</div>
                <div class="reply-date">{{ reply.created_at.strftime('%d.%m.%Y %H:%M') }}</div>
            </div>
            <div class="reply-content">
                {{ reply.content|replace('\n', '<br>')|safe }}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-replies">
            <p>Пока нет ответов. Будьте первым!</p>
        </div>
    {% endif %}
</div>

{% if current_user.is_authenticated %}
<div class="reply-form" id="reply-form">
    <h2 class="section-title">Добавить ответ</h2>
    <form method="POST" action="{{ url_for('reply', topic_id=topic.id) }}">
        <div class="form-group">
            <label for="content">Ваш ответ:</label>
            <textarea class="form-control" id="content" name="content" rows="6" required></textarea>
        </div>
        <button type="submit" class="btn">Отправить ответ</button>
    </form>
</div>
{% endif %}
{% endblock %}
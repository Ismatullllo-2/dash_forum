{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>{{ topic.title }}</h1>
    <p>Автор: {{ topic.author.username }} | Дата: {{ topic.created_at }}</p>
    <p>Просмотров: {{ topic.views }} | Ответов: {{ topic.reply_count }}</p>
    
    <div class="topic-content">
        {{ topic.content }}
    </div>
    
    {% if topic.attachments %}
    <div class="attachments">
        <h4>Прикрепленные файлы:</h4>
        {% for attachment in topic.attachments %}
        <a href="{{ url_for('uploaded_file', filename=attachment.filename) }}" 
           download="{{ attachment.original_filename }}">
            {{ attachment.original_filename }}
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <h3>Ответы ({{ topic.reply_count }}):</h3>
    {% for reply in topic.replies %}
    <div class="reply">
        <p><strong>{{ reply.author.username }}</strong> - {{ reply.created_at }}</p>
        <p>{{ reply.content }}</p>

        {% if reply.attachments %}
        <div class="attachments">
            {% for attachment in reply.attachments %}
            <a href="{{ url_for('uploaded_file', filename=attachment.filename) }}" 
               download="{{ attachment.original_filename }}">
                {{ attachment.original_filename }}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
    
    {% if current_user.is_authenticated %}
    <form method="POST" action="{{ url_for('reply', topic_id=topic.id) }}" enctype="multipart/form-data">
        <textarea name="content" placeholder="Ваш ответ..." required></textarea>
        <input type="file" name="files" multiple>
        <button type="submit">Ответить</button>
    </form>
    {% else %}
    <p><a href="{{ url_for('login') }}">Войдите</a>, чтобы ответить</p>
    {% endif %}
</div>
{% endblock %}